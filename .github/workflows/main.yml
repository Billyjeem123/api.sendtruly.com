name: Deploy

on:
  push:
    branches:
      - master
      - v2  # Add v2 g branch to trigger deployment

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest

    steps:
      - name: Start Deployment
        run: echo "üöÄ Starting deployment process..."

      - uses: actions/checkout@v3

      - name: Display Deployment Branch
        run: echo "üîπ Deploying to '${{ github.ref_name }}' branch"

      - name: Set FTP Credentials and Directory
        run: |
          echo "‚öôÔ∏è Setting credentials and path for branch: ${{ github.ref_name }}"
          echo "FTP_SERVER=${{ secrets.FTP_SERVER }}" >> $GITHUB_ENV
          echo "FTP_USERNAME=${{ secrets.FTP_USERNAME }}" >> $GITHUB_ENV
          echo "FTP_PASSWORD=${{ secrets.FTP_PASSWORD }}" >> $GITHUB_ENV

          if [ "${{ github.ref_name }}" == "master" ]; then
            echo "FTP_SERVER_DIR=api.sendtruly.com/" >> $GITHUB_ENV
          elif [ "${{ github.ref_name }}" == "v2" ]; then
            echo "FTP_SERVER_DIR=api.sendtruly.com/" >> $GITHUB_ENV
          else
            echo "‚ùå Unknown branch, skipping deployment"
            exit 1
          fi

      - name: Deploy via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ env.FTP_SERVER }}
          username: ${{ env.FTP_USERNAME }}
          password: ${{ env.FTP_PASSWORD }}
          protocol: ftp
          local-dir: ./  # Directory to upload
          server-dir: ${{ env.FTP_SERVER_DIR }}  # Dynamic path


      - name: Deployment Status
        run: echo "‚úÖ Deployment to ${{ github.ref_name }} completed successfully!"
